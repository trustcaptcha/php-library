image: php:7.4

stages:
  - publish

before_script:
  - apt-get update -qq && apt-get install -y -qq unzip git
  - curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer
  - composer install --prefer-dist --no-ansi --no-interaction --no-progress

publish-to-packagist:
  stage: publish
  tags:
    - build
  only:
    - tags
  script:
    - echo "Publishing ${CI_COMMIT_TAG} to Packagist..."
    - 'curl -X POST -H "Authorization: token ${PACKAGIST_API_TOKEN}" "https://packagist.org/api/update-package?username=YOUR_PACKAGIST_USERNAME&apiToken=${PACKAGIST_API_TOKEN}" -d "{\"repository\":{\"url\":\"${CI_PROJECT_URL}\"}}"'
